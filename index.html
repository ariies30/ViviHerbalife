<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Benessere & Nutrizione – Shop</title>
<meta name="theme-color" content="#8bc34a" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f3f9f6; --card:#fff; --muted:#6b7280; --text:#1f2937;
  --brand:#4caf50; --brand-2:#8bc34a; --accent:#ffb300; --danger:#e53935;
}
*{box-sizing:border-box} html,body{margin:0}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:24px}
header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.8);backdrop-filter:blur(10px);border-bottom:1px solid #e5e7eb}
.nav{display:flex;gap:16px}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand-logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-2));display:grid;place-items:center;color:#fff;font-weight:900}
header .brand{position:relative;z-index:10;cursor:pointer}
.nav a{padding:10px 12px;border-radius:10px;color:var(--muted)}
.nav a.active,.nav a:hover{background:#eef2ff}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px; transition: transform 0.25s ease, box-shadow 0.25s ease; box-shadow:0 8px 30px rgba(0,0,0,.06)}
.card.pad{padding:20px}
.card:hover{
  transform: translateY(-6px);
  box-shadow:0 8px 24px rgba(0,0,0,.25);
}
.muted{color:var(--muted)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:12px;border:1px solid #cbd5e1;background:#f1f5f9;color:#0f172a;cursor:pointer;font-weight:600}
.btn:hover{filter:brightness(.98)}
.btn.brand{background:linear-gradient(135deg,var(--brand),var(--brand-2));border:none;color:#06231f}
.btn.ghost{background:transparent}
.input{background:#f8fafc;border:1px solid #cbd5e1;border-radius:12px;padding:12px 14px;color:#0f172a;width:100%}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px}
.product{overflow:hidden;position:relative}
.product .img-wrap{aspect-ratio:4/3;background:#e2e8f0;border-bottom:1px solid #e5e7eb;display:grid;place-items:center}
.product .img-wrap {
  aspect-ratio:4/3;
  background:#0c1429;
  display:grid;
  place-items:center;
  overflow:hidden;
  border-bottom:1px solid #1e293b;
}

.product img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transition: transform 0.3s ease;
}

.product:hover img {
  transform: scale(1.1);
}

.price{font-weight:800}
.badge{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,var(--accent),#f97316);color:#0a0e1a;font-weight:800;padding:6px 10px;border-radius:999px;font-size:.8rem}
.cart-button{position:relative}
.cart-count{position:absolute;top:-8px;right:-8px;background:#22c55e;color:#051413;border:2px solid var(--bg);width:26px;height:26px;display:grid;place-items:center;border-radius:50%;font-weight:800;font-size:.8rem}
.sidebar{position:fixed;inset:0 0 0 auto;width:380px;background:var(--card);border-left:1px solid #e5e7eb;transform:translateX(100%);transition:.3s;z-index:60;display:flex;flex-direction:column}
.sidebar.open{transform:translateX(0)}
.sidebar header{position:sticky;top:0;background:var(--card);padding:16px;border-bottom:1px solid #e5e7eb}
.cart-items{padding:16px;display:flex;flex-direction:column;gap:12px;overflow:auto}
.cart-row{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:8px}
.qty{display:inline-flex;border:1px solid #cbd5e1;border-radius:10px;overflow:hidden}
.qty button{background:#f1f5f9;border:none;padding:8px 10px;cursor:pointer}
.qty input{width:40px;text-align:center;background:#f8fafc;border:none}
.totals{border-top:1px solid #e5e7eb;margin-top:auto;padding:16px;display:grid;gap:10px}
.ribbon{display:flex;gap:12px;flex-wrap:wrap}
footer{margin-top:40px;border-top:1px solid #e5e7eb}
.cols{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
.hidden{display:none!important}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:70}
.modal.open{display:flex}
.modal .dialog{width:min(920px,94vw);background:var(--card);border:1px solid #e5e7eb;border-radius:18px;overflow:hidden}
.dialog-body{display:grid;grid-template-columns:1fr 1fr}
.dialog-body .left{background:#e2e8f0}
.dialog-body .right{padding:18px}
.notice{font-size:.9rem;color:#334155;background:#f8fafc;border:1px dashed #cbd5e1;padding:10px;border-radius:12px}
@media(max-width:980px){.dialog-body{grid-template-columns:1fr}}
  /* ---- SHOP con sidebar filtri ---- */
.layout-shop{
  display:grid;
  grid-template-columns: 260px 1fr;
  gap:20px;
  align-items:start;
  margin-top:20px;
}
.sidebar-filters{
  position:sticky; top:84px;
  background:var(--card);
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:16px;
  box-shadow:0 8px 30px rgba(0,0,0,.06);
}
.filter-group{margin-bottom:16px}
.filter-group h4{margin:0 0 8px; font-size:0.95rem}
.filter-row{display:flex; align-items:center; gap:10px; margin:6px 0}
.range{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.small{font-size:.9rem}
.clearline{display:flex; justify-content:space-between; align-items:center}
.btn.small{padding:8px 10px; border-radius:10px; font-size:.9rem}

/* Mobile: sidebar sopra */
@media (max-width: 980px){
  .layout-shop{grid-template-columns:1fr}
  .sidebar-filters{position:static}
}
  .badge-wrap {
  position: absolute;
  top: 12px;
  left: 12px;
  display: flex;
  gap: 6px;
}

.badge {
  background: linear-gradient(135deg, var(--accent), #f97316);
  color: #0a0e1a;
  font-weight: 800;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: .8rem;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
}
  .btn.active {
  background: var(--brand);
  color: #fff;
  border-color: var(--brand);
}
.floating-cart {
  position: fixed;
  right: 24px;
  bottom: 44px; /* posizione di default */
}

/* Se l’altezza dello schermo è inferiore a 700px (es. alcuni telefoni) */
@media (max-height: 700px) {
  .floating-cart {
    bottom: 10px; /* più basso, evita che esca fuori */
  }
}
  /* Imposta i campi prezzo con minimo 0 */
#minPrice,
#maxPrice {
  min: 0; /* vieta valori negativi */
}

/* Ingrandisce le frecce (browser WebKit/Chromium) */
#minPrice::-webkit-inner-spin-button,
#maxPrice::-webkit-inner-spin-button,
#minPrice::-webkit-outer-spin-button,
#maxPrice::-webkit-outer-spin-button {
  transform: scale(1.4); /* aumenta la dimensione */
  margin: 0 2px; /* aggiusta lo spazio */
}

/* Per Firefox */
#minPrice,
#maxPrice {
  -moz-appearance: textfield; /* rimuove lo stile base */
}
#minPrice::-moz-number-spin-box,
#maxPrice::-moz-number-spin-box {
  transform: scale(1.3);
}
</style>
</head>
<body>
<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px;height:64px">
    <a href="#shop" class="brand">
      <div class="brand-logo">BN</div>
      <div>
        <div>Benessere & Nutrizione</div>
        <div class="muted" style="font-size:.8rem;font-weight:600">Rivenditore indipendente*</div>
      </div>
    </a>
    <nav class="nav" id="nav">
      <a href="#shop" data-route>Shop</a>
      <a href="#programmi" data-route>Programmi</a>
      <a href="#about" data-route>Chi siamo</a>
      <a href="#faq" data-route>FAQ</a>
      <a href="#policies" data-route>Policy</a>
      <a href="#contatti" data-route>Contatti</a>
    </nav>
    <div class="floating-cart">
      <button class="btn cart-button" id="openCart" aria-label="Apri carrello">🛒 Carrello <span class="cart-count" id="cartCount">0</span></button>
    </div>
  </div>
</header>

<main class="container" id="view"></main>

<aside class="sidebar" id="cartSidebar" aria-hidden="true">
  <header style="display:flex;align-items:center;justify-content:space-between">
    <strong>Il tuo carrello</strong>
    <button class="btn ghost" id="closeCart">✕</button>
  </header>
  <div class="cart-items" id="cartItems"></div>
  <div class="totals">
    <div style="display:flex;align-items:center;justify-content:space-between"><span>Subtotale</span><strong id="subtotal">€0,00</strong></div>
    <div class="notice">Spedizione calcolata al checkout. Concludi l'ordine via link di pagamento o WhatsApp/email.</div>
    <div class="ribbon">
      <button class="btn danger" id="clearCart">Svuota</button>
      <button class="btn brand" id="checkoutBtn">Checkout</button>
    </div>
    <div class="muted" style="font-size:.8rem">*Sito non ufficiale del brand. Gestito da Incaricato/a Indipendente.</div>
  </div>
</aside>

<!-- Modal Prodotto -->
<div class="modal" id="productModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="dialog">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #e5e7eb">
      <strong id="modalTitle">Dettagli prodotto</strong>
      <button class="btn ghost" id="closeModal">✕</button>
    </div>
    <div class="dialog-body">
      <div class="left"><img id="modalImg" alt="Immagine prodotto" style="width:100%;height:100%;object-fit:cover"></div>
      <div class="right">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div class="price" id="modalPrice">€0,00</div>
          <div class="chip" id="modalCategory">Categoria</div>
        </div>
        <p class="muted" id="modalDesc" style="line-height:1.6"></p>
        <div style="display:flex;gap:10px;align-items:center;margin:10px 0">
          <div class="qty">
            <button type="button" data-qty="-1">−</button>
            <input id="modalQty" value="1" inputmode="numeric" pattern="[0-9]*"/>
            <button type="button" data-qty="1">＋</button>
          </div>
          <button class="btn brand" id="modalAdd">Aggiungi al carrello</button>
          <a class="btn" id="modalBuy" target="_blank" rel="noopener">Compra ora</a>
        </div>
        <div class="notice">Se presente, <b>Compra ora</b> apre un link di pagamento diretto (es. Stripe). In alternativa, usa il carrello.</div>
      </div>
    </div>
  </div>
</div>

<footer class="container">
  <div class="cols" style="padding:24px 0">
    <div>
      <div class="brand" style="margin-bottom:10px"><div class="brand-logo">BN</div><strong>Benessere & Nutrizione</strong></div>
      <p class="muted">Soluzioni per il benessere quotidiano: nutrizione bilanciata, energia e idratazione. Consulenze su richiesta.</p>
      <div class="ribbon">
        <span class="chip">Supporto: <a href="#contatti">contattaci</a></span>
        <span class="chip">Instagram</span>
        <span class="chip">Facebook</span>
      </div>
    </div>
    <div>
      <strong>Pagine</strong>
      <ul class="muted">
        <li><a href="#shop">Shop</a></li>
        <li><a href="#programmi">Programmi</a></li>
        <li><a href="#about">Chi siamo</a></li>
        <li><a href="#faq">FAQ</a></li>
        <li><a href="#policies">Policy</a></li>
        <li><a href="#contatti">Contatti</a></li>
      </ul>
    </div>
    <div>
      <strong>Trasparenza</strong>
      <p class="muted" style="line-height:1.6">Questo sito è gestito da un/una Incaricato/a Indipendente. I prodotti sono integratori alimentari e non sostituiscono una dieta varia ed equilibrata né uno stile di vita sano. Per condizioni mediche, consultare un professionista.</p>
    </div>
  </div>
  <div class="muted" style="border-top:1px solid #e5e7eb;padding:16px 0;font-size:.9rem">© <span id="year"></span> Benessere & Nutrizione — Tutti i diritti riservati.</div>
</footer>

<script>
/*** CONFIG ***/
const CONFIG = {
  shopName: "Benessere & Nutrizione",
  whatsapp: "+393479608643",
  email: "vivimarletta68@gmail.com",
  currency: "EUR"
};

/*** PRODUCTS ***/
const PRODUCTS = [
  { id:"f1-shake-vanilla", name:"Formula 1 – Shake Vaniglia", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-vanilla.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
  { id:"f1-shake-chocolate", name:"Formula 1 – Shake Cioccolato", price:35.90, tags: ["best-seller"], category:"Sostitutivi pasto",
   image:"images/f1-chocolate.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
  { id:"f1-shake-biscuit", name:"Formula 1 – Shake Biscotto", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-biscuit.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
  { id:"f1-shake-raspberry", name:"Formula 1 – Shake Lampone", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-raspberry.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
  { id:"f1-shake-strawberry", name:"Formula 1 – Shake Fragola", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-strawberry.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
    { id:"f1-shake-banana", name:"Formula 1 – Shake Banana", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-banana.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", paymentLink:"" },
    { id:"f1-shake-cappuccino", name:"Formula 1 – Shake Cappuccino", price:35.90, category:"Sostitutivi pasto",
   image:"images/f1-cappuccino.jpeg",
   desc:"Frullato nutrizionale bilanciato per colazioni complete o pasti leggeri.", tags: ["best-seller"], paymentLink:"" },
    { id:"h24-strength", name:"Herbalife 24 – Rebuild Strength (Cioccolato)", price:35.90, category:"Nutrizione sportiva",
   image:"images/h24-strength.jpeg",
   desc:"Un integratore alimentare per il recupero post-allenamento a base di proteine con aggiunta di glutammina e BCAA da utilizzare dopo l'esercizio anaerobico.", tags: ["offer"], paymentLink:"" },
    { id:"h24-endurance", name:"Herbalife 24 – Rebuild Endurance (Vaniglia)", price:35.90, category:"Nutrizione sportiva",
   image:"images/h24-endurance.jpeg",
   desc:"Un integratore a base di proteine per il recupero post-allenamento ​​con aggiunta di glutammina e BCAA da utilizzare dopo l'esercizio anaerobico.", tags: ["offer"], paymentLink:"" },
 { id:"herbalife-V", name:"HERBALIFE V Plant-Based Protein Shake (classic)", price:35.90, category:"Plant-Based",
   image:"images/herbalife-V.jpeg",
   desc:"Frullato proteico a base vegetale, ideale per diete vegane, vegetariane e flessibili.", tags: ["new"], paymentLink:"" },
];

/*** UTIL ***/
const qs=(s,el=document)=>el.querySelector(s);
const qsa=(s,el=document)=>[...el.querySelectorAll(s)];
const money = v => new Intl.NumberFormat('it-IT',{style:'currency',currency:CONFIG.currency}).format(v);

const store = {
  read(){ try{return JSON.parse(localStorage.getItem('cart')||'[]')}catch{return []} },
  write(items){ localStorage.setItem('cart', JSON.stringify(items)); updateCartCount(); }
};

function updateCartCount(){
  const count = store.read().reduce((a,i)=>a+i.qty,0);
  qs('#cartCount').textContent = count;
}
function addToCart(prod, qty=1){
  const items = store.read();
  const i = items.findIndex(x=>x.id===prod.id);
  if(i>-1) items[i].qty += qty; else items.push({id:prod.id,name:prod.name,price:prod.price,image:prod.image,qty});
  store.write(items); renderCart(); openCart();
}
function removeFromCart(id){ store.write(store.read().filter(x=>x.id!==id)); renderCart(); }
function setQty(id,qty){ const items=store.read(); const i=items.findIndex(x=>x.id===id); if(i>-1){items[i].qty=Math.max(1,qty|0); store.write(items); renderCart();} }
function subtotal(){ return store.read().reduce((a,i)=>a+i.price*i.qty,0) }
function openCart(){ const s=qs('#cartSidebar'); s.classList.add('open'); s.setAttribute('aria-hidden','false'); }
function closeCart(){ const s=qs('#cartSidebar'); s.classList.remove('open'); s.setAttribute('aria-hidden','true'); }
function openModal(p){
  qs('#modalTitle').textContent=p.name;
  qs('#modalImg').src=p.image;
  qs('#modalPrice').textContent=money(p.price);
  qs('#modalCategory').textContent=p.category;
  qs('#modalDesc').textContent=p.desc;
  qs('#modalQty').value=1;
  const buy=qs('#modalBuy');
  if(p.paymentLink){ buy.href=p.paymentLink; buy.classList.remove('hidden'); } else { buy.href='#'; buy.classList.add('hidden'); }
  qs('#modalAdd').onclick=()=>addToCart(p, parseInt(qs('#modalQty').value||'1',10));
  qsa('[data-qty]').forEach(btn=> btn.onclick=()=>{ const v=parseInt(qs('#modalQty').value||'1',10)+parseInt(btn.dataset.qty,10); qs('#modalQty').value=Math.max(1,v); });
  qs('#productModal').classList.add('open');
}
function closeModal(){ qs('#productModal').classList.remove('open'); }

/*** ROUTER ***/
const routes = {
  '#shop': renderShop,
  '#programmi': renderPrograms,
  '#about': renderAbout,
  '#faq': renderFAQ,
  '#policies': renderPolicies,
  '#contatti': renderContacts,
};
function setActiveNav(){ const h=location.hash||'#shop'; qsa('[data-route]').forEach(a=> a.classList.toggle('active', a.getAttribute('href')===h)); }
window.addEventListener('hashchange', mount);
function mount(){ const hash=location.hash||'#shop'; setActiveNav(); (routes[hash]||renderShop)(); }

function renderShop(){
  const view = qs('#view');

  // categorie e tag dinamici dal catalogo
  const categories = [...new Set(PRODUCTS.map(p=>p.category))].sort();
  const tags = [...new Set(PRODUCTS.flatMap(p=>p.tags||[]))].sort();

  view.innerHTML = `
    <section class="layout-shop">

      <!-- SIDEBAR FILTRI -->
      <aside class="sidebar-filters">
        <div class="clearline">
          <h3 style="margin:0">Filtri</h3>
          <button id="resetAll" class="btn ghost small">Reset</button>
        </div>

        <div class="filter-group">
          <h4>Cerca</h4>
          <input class="input" id="search" placeholder="Nome, categoria, parola…">
        </div>

        <div class="filter-group">
          <h4>Categoria</h4>
          <div id="catWrap"></div>
        </div>

        <div class="filter-group">
          <h4>Prezzo</h4>
          <div class="range">
            <input class="input" id="minPrice" type="number" step="1.00" min="0" max="1000" placeholder="Min">
            <input class="input" id="maxPrice" type="number" step="1.00" min="0" max="1000" placeholder="Max">
          </div>
        </div>

        ${tags.length ? `
        <div class="filter-group">
          <h4>Tag</h4>
          <div id="tagWrap" style="display:flex;flex-wrap:wrap;gap:8px"></div>
        </div>` : ''}

        <p class="muted small" style="margin:0">Suggerimenti: puoi combinare ricerca + categorie + prezzo.</p>
      </aside>

      <!-- CONTENUTO -->
      <div>
        <section class="card pad">
          <div class="clearline" style="margin-bottom:12px">
            <strong>Prodotti</strong>
            <div class="muted" id="count"></div>
          </div>
          <div class="toolbar" style="margin-bottom:12px">
            <button class="btn" id="quickNew">🆕 Novità</button>
            <button class="btn" id="quickOffer">🔥 Offerte</button>
            <button class="btn" id="quickBest">🏆 Best Seller</button>
            <button class="btn ghost" id="quickReset">Reset</button>
          </div>

          <div class="products" id="products"></div>
        </section>
      </div>
    </section>`;

  // --- render controlli sidebar ---
  const catWrap = qs('#catWrap');
  catWrap.innerHTML = categories.map(c => `
    <label class="filter-row">
      <input type="checkbox" name="cat" value="${c}">
      <span class="small">${c}</span>
    </label>
  `).join('');

  const tagWrap = qs('#tagWrap');
  if (tagWrap) {
    tagWrap.innerHTML = tags.map(t => `
      <label class="pill" style="user-select:none">
        <input type="checkbox" name="tag" value="${t}" style="display:none">
        ${t}
      </label>
    `).join('');
    // stile attivo sui tag-pill
    tagWrap.querySelectorAll('label.pill').forEach(lbl=>{
      lbl.addEventListener('click', ()=>{
        const input = lbl.querySelector('input');
        input.checked = !input.checked;
        lbl.classList.toggle('active', input.checked);
      });
    });
  }

  // --- render list ---
  const listEl = qs('#products');
  const countEl = qs('#count');

  function renderList(list){
    countEl.textContent = `${list.length} risultati`;
    listEl.innerHTML = list.map(p=>`
      <article class="product card">
        <div class="img-wrap" style="cursor:pointer" data-action="view" data-id="${p.id}">
          <img src="${p.image}" alt="${p.name}" loading="lazy">
          <div class="badge-wrap">
            ${p.tags?.includes('new') ? '<span class="badge">NUOVO</span>' : ''}
            ${p.tags?.includes('best-seller') ? '<span class="badge">BEST</span>' : ''}
            ${p.tags?.includes('offer') ? '<span class="badge">OFFERTA</span>' : ''}
          </div>
        </div>
        <div class="pad" style="padding:14px">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
            <h3 style="margin:0;font-size:1rem;cursor:pointer" data-action="view" data-id="${p.id}">
              ${p.name}
            </h3>
            <div class="price">${money(p.price)}</div>
          </div>
          <div class="muted" style="font-size:.9rem;margin:6px 0 10px">${p.category}</div>
          <div class="toolbar">
            <button class="btn brand" data-action="add" data-id="${p.id}">Aggiungi</button>
            <button class="btn" data-action="view" data-id="${p.id}">Dettagli</button>
            ${p.paymentLink?`<a class="btn" href="${p.paymentLink}" target="_blank" rel="noopener">Compra ora</a>`:''}
          </div>
        </div>
      </article>
    `).join('');

    // Bind bottoni card
    listEl.querySelectorAll('[data-action="add"]').forEach(b=> b.onclick = ()=> addToCart(PRODUCTS.find(p=>p.id===b.dataset.id)));
    listEl.querySelectorAll('[data-action="view"]').forEach(b=> b.onclick = ()=> openModal(PRODUCTS.find(p=>p.id===b.dataset.id)));
  }

  // iniziale
  renderList(PRODUCTS);

  // --- filtro combinato ---
  function applyFilters(){
    const q = (qs('#search')?.value || '').toLowerCase().trim();
    const catSelected = qsa('input[name="cat"]:checked').map(i=>i.value);
    const tagsSelected = qsa('input[name="tag"]:checked').map(i=>i.value);

    // pulsanti rapidi attivi
    const quickTags = [];
    if (qs('#quickNew').classList.contains('active')) quickTags.push('new');
    if (qs('#quickOffer').classList.contains('active')) quickTags.push('offer');
    if (qs('#quickBest').classList.contains('active')) quickTags.push('best-seller');

    const min = parseFloat(qs('#minPrice')?.value || '') || -Infinity;
    const max = parseFloat(qs('#maxPrice')?.value || '') || Infinity;

    const filtered = PRODUCTS.filter(p=>{
      const matchText = !q || p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q);
      const matchCat = !catSelected.length || catSelected.includes(p.category);
      const matchPrice = p.price >= min && p.price <= max;
      const matchTags = [...tagsSelected, ...quickTags];
      const matchAnyTag = !matchTags.length || (p.tags||[]).some(t=> matchTags.includes(t));
      return matchText && matchCat && matchPrice && matchAnyTag;
    });

    renderList(filtered);
  }

  // Eventi sidebar
  const debounce = (fn, ms=200) => { let t; return (...args) => { clearTimeout(t); t=setTimeout(()=>fn(...args), ms); }; };
  const applyFiltersDebounced = debounce(applyFilters, 200);

  qs('#search')?.addEventListener('input', applyFiltersDebounced);
  qs('#minPrice')?.addEventListener('input', applyFiltersDebounced);
  qs('#maxPrice')?.addEventListener('input', applyFiltersDebounced);
  qsa('input[name="cat"]').forEach(i => i.addEventListener('change', applyFilters));
  qsa('#tagWrap input[name="tag"]').forEach(i => i.addEventListener('change', applyFilters));

  // Gestione pulsanti rapidi
  ['#quickNew','#quickOffer','#quickBest'].forEach(sel=>{
    qs(sel).addEventListener('click', e=>{
      e.target.classList.toggle('active');
      applyFilters();
    });
  });

  // Reset sidebar + pulsanti rapidi
  qs('#resetAll').addEventListener('click', ()=>{
    qs('#search').value='';
    qsa('input[name="cat"]').forEach(i=> i.checked=false);
    qsa('input[name="tag"]').forEach(i=> { 
      i.checked=false; 
      i.closest('label.pill')?.classList.remove('active'); 
    });
    qs('#minPrice').value=''; 
    qs('#maxPrice').value='';
    ['#quickNew','#quickOffer','#quickBest'].forEach(sel=>qs(sel).classList.remove('active'));
    renderList(PRODUCTS);
  });

  qs('#quickReset').addEventListener('click', ()=>{
    ['#quickNew','#quickOffer','#quickBest'].forEach(sel=>qs(sel).classList.remove('active'));
    renderList(PRODUCTS);
  });
}


function renderPrograms(){
  qs('#view').innerHTML=`
    <section class="card pad" style="margin-top:20px">
      <h2 style="margin-top:0">Programmi & Pacchetti</h2>
      <div class="products" style="margin-top:10px">
        <article class="product card pad"><h3>Start 10 giorni</h3><p class="muted">Shake + Tè alle erbe + Aloe. Guida rapida e supporto via chat.</p></article>
        <article class="product card pad"><h3>Equilibrio quotidiano</h3><p class="muted">Multivitaminico + Snack proteici + Idratazione.</p></article>
        <article class="product card pad"><h3>Energia & Focus</h3><p class="muted">Bevande energizzanti e supporto alla concentrazione.</p></article>
      </div>
    </section>`;
}
function renderAbout(){
  qs('#view').innerHTML=`
    <section class="card pad" style="margin-top:20px">
      <h2 style="margin-top:0">Chi siamo</h2>
      <p class="muted">Siamo incaricati/e indipendenti: aiutiamo a costruire abitudini sane con soluzioni semplici e sostenibili. Consulenze personalizzate e assistenza post-acquisto.</p>
      <ul class="muted"><li>Valutazione iniziale gratuita</li><li>Piani flessibili</li><li>Supporto via chat</li></ul>
    </section>`;
}
function renderFAQ(){
  qs('#view').innerHTML=`
    <section class="card pad" style="margin-top:20px">
      <h2 style="margin-top:0">FAQ</h2>
      <details open><summary><strong>Gli integratori sostituiscono la dieta?</strong></summary><p class="muted">No. Supportano una dieta varia ed equilibrata e uno stile di vita sano.</p></details>
      <details><summary><strong>Spedizione</strong></summary><p class="muted">24-72h lavorative. Costo calcolato al checkout o nel preventivo.</p></details>
      <details><summary><strong>Piani personalizzati</strong></summary><p class="muted">Sì, contattaci per una call gratuita.</p></details>
    </section>`;
}
function renderPolicies(){
  qs('#view').innerHTML=`
    <section class="card pad" style="margin-top:20px">
      <h2 style="margin-top:0">Policy</h2>
      <h3>Resi</h3><p class="muted">Reso entro 14 giorni su prodotti integri e non aperti. Scrivi a <a href="mailto:${CONFIG.email}">${CONFIG.email}</a>.</p>
      <h3>Pagamenti</h3><p class="muted">Accettiamo link di pagamento (Stripe/PayPal) e bonifico.</p>
      <h3>Trasparenza</h3><p class="muted">Sito gestito da Incaricato/a Indipendente. Le info non sostituiscono il parere medico.</p>
    </section>`;
}
function renderContacts(){
  qs('#view').innerHTML=`
    <section class="card pad" style="margin-top:20px">
      <h2 style="margin-top:0">Contatti</h2>
      <p class="muted">Scrivimi su WhatsApp o via email. Puoi anche chiamarmi o seguirmi sui social.</p>
      <div class="toolbar" style="margin:10px 0 20px">
        <a class="btn brand" id="whatsContact">☎️ WhatsApp</a>
        <a class="btn" id="mailContact">✉️ Email</a>
      </div>
      <div class="ribbon" style="margin-top:4px">
        <a class="btn ghost" href="tel:+393479608643">📞 Chiama</a>
        <a class="btn ghost" href="https://www.instagram.com/viviana_marletta/" target="_blank" rel="noopener">📷 Instagram</a>
        <a class="btn ghost" href="https://www.facebook.com/viviana.marletta?locale=it_IT" target="_blank" rel="noopener">📘 Facebook</a>
      </div>
    </section>`;
  qs('#whatsContact').href=`https://wa.me/${CONFIG.whatsapp.replace(/[^\d]/g,'')}?text=${encodeURIComponent('Ciao! Vorrei info sui vostri prodotti/programmi.')}`;
  const subject="Richiesta informazioni";
  const body="Ciao, vorrei avere maggiori informazioni sui vostri prodotti/programmi.";
  qs('#mailContact').href=`mailto:${CONFIG.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

/*** CARRELLO ***/
function renderCart(){
  const wrap=qs('#cartItems'); const items=store.read();
  wrap.innerHTML = items.length? items.map(i=>`
    <div class="cart-row">
      <img src="${i.image}" alt="${i.name}" style="width:64px;height:64px;object-fit:cover;border-radius:8px">
      <div>
        <div style="font-weight:600">${i.name}</div>
        <div class="muted">${money(i.price)}</div>
        <div class="qty" style="margin-top:6px">
          <button onclick="setQty('${i.id}',${i.qty-1})">−</button>
          <input value="${i.qty}" oninput="setQty('${i.id}', this.value)">
          <button onclick="setQty('${i.id}',${i.qty+1})">＋</button>
        </div>
      </div>
      <div style="display:grid;gap:8px;justify-items:end">
        <strong>${money(i.price*i.qty)}</strong>
        <button class="btn ghost" onclick="removeFromCart('${i.id}')">Rimuovi</button>
      </div>
    </div>`).join('') : `<div class="notice">Il carrello è vuoto. Aggiungi prodotti dal <a href="#shop">negozio</a>.</div>`;
  qs('#subtotal').textContent = money(subtotal());
}
function checkout(){
  const items=store.read(); if(!items.length){ alert('Il carrello è vuoto'); return; }
  const lines=items.map(i=>`• ${i.name} × ${i.qty} — ${money(i.price*i.qty)}`).join('\n');
  const text=`Ordine ${CONFIG.shopName}\n${lines}\nSubtotale: ${money(subtotal())}\n\nIndica indirizzo e metodo di pagamento preferito.`;
  const wa=`https://wa.me/${CONFIG.whatsapp.replace(/[^\d]/g,'')}?text=${encodeURIComponent(text)}`;
  const opened=window.open(wa,'_blank'); if(!opened){ location.href=`mailto:${CONFIG.email}?subject=Nuovo ordine&body=${encodeURIComponent(text)}`; }
}

/*** INIT ***/
qs('#openCart').onclick=openCart;
qs('#closeCart').onclick=closeCart;
qs('#clearCart').onclick=()=>{ localStorage.removeItem('cart'); updateCartCount(); renderCart(); };
qs('#checkoutBtn').onclick=checkout;
qs('#closeModal').onclick=closeModal;
document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ closeCart(); closeModal(); }});
qs('#year').textContent = new Date().getFullYear();

// primo mount
updateCartCount(); renderCart();
if(!location.hash) location.hash='#shop';
mount();
</script>
</body>
</html>
